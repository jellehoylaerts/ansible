{{ ansible_managed }}

vrrp_script chk_haproxy {
  script "/etc/keepalived/check_script.sh"
  interval 2                      # check every 2 seconds
}

vrrp_instance VI_1 {
  interface {{ harp.interface }} # interface to monitor
  state {{ keepalived_role }}
  virtual_router_id {{ harp.router_id }}
  {% if keepalived_role.lower() == "master" %}
  priority {{ keepalived.priority }}
  {% else %}
  priority {{ keepalived.backup_priority }}
  {% endif %}
  authentication {
    auth_type PASS
    auth_pass {{ keepalived.auth_pass }}
  }
  virtual_ipaddress {
    {{ harp.vip }} # virtual ip address 
  }
  track_script {
    chk_haproxy
  }
}
